dist: bionic
sudo: required
services:
  - docker

env:
  # Global environment variables
  global:
    # Commit SHA for tracking needs
    - COMMIT_SHA=${TRAVIS_COMMIT::8}

stages:
  - name: "Prepare"
    if: |
      (branch = master) OR \
      (tag =~ /^v(\d+\.)(\d+\.)(\*|\d+)$/ AND branch = master) OR \
      (type=pull_request AND branch=master) OR \
      (branch =~ /^hotfix\/(.*)/) OR \
      (branch =~ /^release\/(.*)/) OR \
      (branch =~ /^builds\/(.*)/) OR \
      (branch =~ /^tests\/(.*)/) OR \
      (branch =~ /^topic\/(.*)/) OR \
      (branch =~ /^hotfix\/(.*)/)

  - name: "Deploy"
    if: (branch=master) AND \
      (tag =~ /^v(\d+\.)(\d+\.)(\*|\d+)$/) AND \
      (type!=pull_request)

jobs:
  include:
    - stage: Prepare
      script:
        - set -Eeo pipefail
        - chmod 755 ./scripts/envinfo.sh
        - bash ./scripts/envinfo.sh > envinfo.txt
        - cat envinfo.txt

        - echo "~~ Build Success ~~"
    - stage: Deploy
      script:
        - set -Eeo pipefail
        - chmod 755 ./scripts/envinfo.sh
        - bash ./scripts/envinfo.sh > envinfo.txt
        - cat envinfo.txt

        - echo "~~ Deploy Success ~~"

notifications:
  email:
    #recipients:
    #  - ${AUTH_EMAIL}
    on_success: never
    on_failure: never
    on_cancel: never
